<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker Dashboard</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-orange-400-rgb: 230, 129, 97;
            --color-bg-1: rgba(59, 130, 246, 0.08);
            --color-bg-2: rgba(245, 158, 11, 0.08);
            --color-bg-3: rgba(34, 197, 94, 0.08);
            --color-bg-4: rgba(239, 68, 68, 0.08);
            --color-bg-5: rgba(147, 51, 234, 0.08);
            --color-bg-6: rgba(249, 115, 22, 0.08);
            --color-bg-7: rgba(236, 72, 153, 0.08);
            --color-bg-8: rgba(6, 182, 212, 0.08);
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-info: var(--color-slate-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);
            --focus-ring: 0 0 0 3px var(--color-focus-ring);
            --focus-outline: 2px solid var(--color-primary);
            --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --radius-full: 9999px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --duration-fast: 150ms;
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-bg-1: rgba(29, 78, 216, 0.15);
                --color-bg-2: rgba(180, 83, 9, 0.15);
                --color-bg-3: rgba(21, 128, 61, 0.15);
                --color-bg-4: rgba(185, 28, 28, 0.15);
                --color-bg-5: rgba(107, 33, 168, 0.15);
                --color-bg-6: rgba(194, 65, 12, 0.15);
                --color-bg-7: rgba(190, 24, 93, 0.15);
                --color-bg-8: rgba(8, 145, 178, 0.15);
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-primary-active: var(--color-teal-800);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-info: var(--color-gray-300);
                --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
            padding: var(--space-24);
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: var(--space-32);
            padding-bottom: var(--space-16);
            border-bottom: 1px solid var(--color-border);
        }

        h1 {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-8);
        }

        .header-info {
            display: flex;
            gap: var(--space-24);
            align-items: center;
            flex-wrap: wrap;
        }

        .month-selector {
            display: flex;
            align-items: center;
            gap: var(--space-12);
        }

        .month-selector button {
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: var(--space-8) var(--space-16);
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            transition: all var(--duration-fast);
        }

        .month-selector button:hover {
            background: var(--color-secondary-hover);
        }

        .month-display {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            min-width: 150px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-32);
        }

        .stat-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            box-shadow: var(--shadow-sm);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-4);
            font-weight: var(--font-weight-medium);
        }

        .stat-value {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .stat-subtext {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--space-4);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--space-24);
        }

        .tracker-section {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-20);
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
        }

        .add-habit-btn {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border: none;
            padding: var(--space-8) var(--space-16);
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
            transition: all var(--duration-fast);
        }

        .add-habit-btn:hover {
            background: var(--color-primary-hover);
        }

        .habit-grid {
            overflow-x: auto;
        }

        .habit-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .habit-table th,
        .habit-table td {
            padding: var(--space-8);
            text-align: center;
            border: 1px solid var(--color-card-border-inner);
            font-size: var(--font-size-sm);
        }

        .habit-table th {
            background: var(--color-secondary);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
            position: sticky;
            top: 0;
        }

        .day-of-week {
            font-size: 10px;
            color: var(--color-text-secondary);
            display: block;
        }

        .habit-name-cell {
            text-align: left !important;
            font-weight: var(--font-weight-medium);
            max-width: 200px;
            position: relative;
        }

        .habit-name-display {
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }

        .habit-name-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .edit-habit-btn {
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: var(--space-4) var(--space-8);
            cursor: pointer;
            font-size: 11px;
            opacity: 0;
            transition: opacity var(--duration-fast);
        }

        .habit-name-cell:hover .edit-habit-btn {
            opacity: 1;
        }

        .edit-habit-btn:hover {
            background: var(--color-secondary-hover);
        }

        .checkbox-cell {
            cursor: pointer;
            transition: background var(--duration-fast);
            position: relative;
        }

        .checkbox-cell:hover {
            background: var(--color-secondary);
        }

        .checkbox-cell.checked {
            background: var(--color-success);
            color: var(--color-btn-primary-text);
        }

        .checkbox-cell.has-note::after {
            content: 'üìù';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            opacity: 0.6;
        }

        .checkbox-cell .checkmark {
            font-weight: bold;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--space-20);
        }

        .analytics-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            box-shadow: var(--shadow-sm);
        }

        .card-title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-16);
        }

        .habit-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-12);
        }

        .habit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-12);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
        }

        .habit-item-name {
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
        }

        .habit-item-score {
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .progress-bar-container {
            margin-top: var(--space-8);
        }

        .progress-bar {
            height: 8px;
            background: var(--color-secondary);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--color-success);
            transition: width var(--duration-normal);
        }

        .streak-display {
            display: flex;
            align-items: center;
            gap: var(--space-8);
            padding: var(--space-12);
            background: var(--color-bg-6);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-12);
        }

        .streak-icon {
            font-size: var(--font-size-2xl);
        }

        .streak-text {
            flex: 1;
        }

        .streak-number {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-warning);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-surface);
            padding: var(--space-32);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-md);
        }

        .modal-header {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-20);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        .form-label {
            display: block;
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--space-8);
            font-size: var(--font-size-sm);
        }

        .form-input {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-background);
            color: var(--color-text);
            font-size: var(--font-size-base);
        }

        .form-input:focus {
            outline: var(--focus-outline);
            border-color: var(--color-primary);
        }

        .emoji-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: var(--space-8);
            margin-top: var(--space-8);
        }

        .emoji-option {
            padding: var(--space-8);
            font-size: var(--font-size-xl);
            cursor: pointer;
            text-align: center;
            border-radius: var(--radius-base);
            border: 2px solid transparent;
            transition: all var(--duration-fast);
        }

        .emoji-option:hover {
            background: var(--color-secondary);
        }

        .emoji-option.selected {
            border-color: var(--color-primary);
            background: var(--color-secondary);
        }

        .modal-actions {
            display: flex;
            gap: var(--space-12);
            justify-content: flex-end;
            margin-top: var(--space-24);
        }

        .btn {
            padding: var(--space-12) var(--space-20);
            border-radius: var(--radius-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            border: none;
            transition: all var(--duration-fast);
        }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-secondary);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: var(--color-secondary-hover);
        }

        .chart-container {
            margin-top: var(--space-16);
            height: 200px;
            position: relative;
        }

        .chart-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 100%;
            gap: var(--space-4);
        }

        .chart-bar {
            flex: 1;
            background: var(--color-primary);
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            position: relative;
            transition: all var(--duration-normal);
            opacity: 0.7;
        }

        .chart-bar:hover {
            opacity: 1;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .best-day-badge {
            display: inline-block;
            background: var(--color-bg-3);
            color: var(--color-success);
            padding: var(--space-4) var(--space-12);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-top: var(--space-8);
        }

        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-8);
            margin-top: var(--space-12);
        }

        .badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-12);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
            border: 2px solid var(--color-border);
        }

        .badge.earned {
            border-color: var(--color-primary);
            background: var(--color-bg-1);
        }

        .badge-icon {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--space-4);
            filter: grayscale(100%);
        }

        .badge.earned .badge-icon {
            filter: grayscale(0%);
        }

        .badge-name {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            text-align: center;
        }

        .note-modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .note-input {
            width: 100%;
            min-height: 100px;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-background);
            color: var(--color-text);
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
            resize: vertical;
        }

        .note-info {
            background: var(--color-bg-1);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
            font-size: var(--font-size-sm);
        }

        .goal-vs-actual {
            display: flex;
            flex-direction: column;
            gap: var(--space-12);
        }

        .goal-item {
            display: flex;
            align-items: center;
            gap: var(--space-12);
        }

        .goal-label {
            min-width: 80px;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        .goal-bar {
            flex: 1;
            height: 24px;
            background: var(--color-secondary);
            border-radius: var(--radius-base);
            position: relative;
            overflow: hidden;
        }

        .goal-bar-fill {
            height: 100%;
            background: var(--color-success);
            transition: width var(--duration-normal);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: var(--space-8);
            color: var(--color-btn-primary-text);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
        }

        .goal-numbers {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            min-width: 60px;
            text-align: right;
        }

        .export-btn {
            background: var(--color-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            padding: var(--space-8) var(--space-16);
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
            transition: all var(--duration-fast);
            margin-left: var(--space-12);
        }

        .export-btn:hover {
            background: var(--color-secondary-hover);
        }

        .context-menu {
            position: fixed;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            box-shadow: var(--shadow-md);
            padding: var(--space-4);
            z-index: 1000;
            display: none;
        }

        .context-menu.active {
            display: block;
        }

        .context-menu-item {
            padding: var(--space-8) var(--space-16);
            cursor: pointer;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            white-space: nowrap;
        }

        .context-menu-item:hover {
            background: var(--color-secondary);
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            body {
                padding: var(--space-16);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .month-selector {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Habit Tracker Dashboard</h1>
            <div class="header-info">
                <div class="month-selector">
                    <button id="prevMonth">‚Üê</button>
                    <div class="month-display" id="monthDisplay"></div>
                    <button id="nextMonth">‚Üí</button>
                </div>
                <button class="add-habit-btn" id="addHabitBtn">+ Add New Habit</button>
                <button class="export-btn" id="exportBtn">üì• Export Data</button>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Habits</div>
                <div class="stat-value" id="totalHabits">0</div>
                <div class="stat-subtext">Active this month</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Completed Tasks</div>
                <div class="stat-value" id="completedTasks">0</div>
                <div class="stat-subtext" id="completionRate">0% completion rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Current Streak</div>
                <div class="stat-value" id="currentStreak">0</div>
                <div class="stat-subtext">days in a row</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Best Habit</div>
                <div class="stat-value" id="bestHabitScore">0%</div>
                <div class="stat-subtext" id="bestHabitName">-</div>
            </div>
        </div>

        <div class="main-content">
            <div class="tracker-section">
                <div class="section-header">
                    <h2 class="section-title">Monthly Habit Tracker</h2>
                </div>
                <div class="habit-grid">
                    <table class="habit-table" id="habitTable">
                        <thead>
                            <tr id="tableHeader">
                                <th class="habit-name-cell">Habit</th>
                            </tr>
                        </thead>
                        <tbody id="habitTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <aside class="sidebar">
                <div class="analytics-card">
                    <h3 class="card-title">üèÜ Badges & Achievements</h3>
                    <div class="badge-container" id="badgeContainer"></div>
                </div>

                <div class="analytics-card">
                    <h3 class="card-title">üéØ Goal vs Actual</h3>
                    <div class="goal-vs-actual" id="goalVsActual"></div>
                </div>

                <div class="analytics-card">
                    <h3 class="card-title">üî• Streak Analysis</h3>
                    <div class="streak-display">
                        <span class="streak-icon">üî•</span>
                        <div class="streak-text">
                            <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">Current Streak</div>
                            <div style="font-weight: var(--font-weight-semibold);">Keep it going!</div>
                        </div>
                        <div class="streak-number" id="streakNumber">0</div>
                    </div>
                    <div class="progress-bar-container">
                        <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-4);">
                            <span style="font-size: var(--font-size-sm);">Monthly Progress</span>
                            <span style="font-size: var(--font-size-sm); font-weight: var(--font-weight-semibold);" id="monthlyProgress">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="card-title">üìä Habit Performance</h3>
                    <div class="habit-list" id="habitPerformanceList">
                    </div>
                </div>

                <div class="analytics-card">
                    <h3 class="card-title">üìÖ Weekly Pattern</h3>
                    <div class="chart-container">
                        <div class="chart-bars" id="weeklyChart"></div>
                    </div>
                    <div style="margin-top: var(--space-24); text-align: center;">
                        <div id="bestDayDisplay"></div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" id="addNoteOption">üìù Add Note</div>
        <div class="context-menu-item" id="viewNoteOption">üëÅÔ∏è View Note</div>
    </div>

    <div class="modal" id="noteModal">
        <div class="modal-content note-modal-content">
            <h3 class="modal-header">Add Note</h3>
            <div class="note-info" id="noteInfo"></div>
            <div class="form-group">
                <label class="form-label">Your Note</label>
                <textarea id="noteText" class="note-input" placeholder="e.g., Felt tired today, completed anyway! üí™"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelNoteBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveNoteBtn">Save Note</button>
            </div>
        </div>
    </div>

    <div class="modal" id="editHabitModal">
        <div class="modal-content">
            <h3 class="modal-header">Edit Habit</h3>
            <form id="editHabitForm">
                <div class="form-group">
                    <label class="form-label" for="editHabitName">Habit Name</label>
                    <input type="text" id="editHabitName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Select Icon</label>
                    <div class="emoji-selector" id="editEmojiSelector">
                        <div class="emoji-option" data-emoji="üí™">üí™</div>
                        <div class="emoji-option" data-emoji="üìö">üìö</div>
                        <div class="emoji-option" data-emoji="üèÉ">üèÉ</div>
                        <div class="emoji-option" data-emoji="üßò">üßò</div>
                        <div class="emoji-option" data-emoji="üíª">üíª</div>
                        <div class="emoji-option" data-emoji="üé®">üé®</div>
                        <div class="emoji-option" data-emoji="üéµ">üéµ</div>
                        <div class="emoji-option" data-emoji="‚úçÔ∏è">‚úçÔ∏è</div>
                        <div class="emoji-option" data-emoji="ü•ó">ü•ó</div>
                        <div class="emoji-option" data-emoji="üíß">üíß</div>
                        <div class="emoji-option" data-emoji="üõå">üõå</div>
                        <div class="emoji-option" data-emoji="üö´">üö´</div>
                        <div class="emoji-option" data-emoji="üì±">üì±</div>
                        <div class="emoji-option" data-emoji="üßº">üßº</div>
                        <div class="emoji-option" data-emoji="üéØ">üéØ</div>
                        <div class="emoji-option" data-emoji="‚è∞">‚è∞</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEditBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="deleteHabitBtn" style="background: var(--color-error); margin-right: auto;">Delete</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="trackingModal">
        <div class="modal-content">
            <h3 class="modal-header">Track Progress</h3>
            <div class="note-info" id="trackingInfo"></div>
            <div id="trackingFormContent"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelTrackingBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveTrackingBtn">Save</button>
            </div>
        </div>
    </div>

    <div class="modal" id="addHabitModal">
        <div class="modal-content">
            <h3 class="modal-header">Add New Habit</h3>
            <form id="addHabitForm">
                <div class="form-group">
                    <label class="form-label" for="habitName">Habit Name</label>
                    <input type="text" id="habitName" class="form-input" placeholder="e.g., Morning Exercise" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Tracking Type</label>
                    <select id="trackingTypeSelect" class="form-input">
                        <option value="checkbox">Checkbox (Yes/No)</option>
                        <option value="time">Time Duration (minutes)</option>
                        <option value="amount">Amount (money/quantity)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Select Icon (Optional)</label>
                    <div class="emoji-selector" id="emojiSelector">
                        <div class="emoji-option" data-emoji="üí™">üí™</div>
                        <div class="emoji-option" data-emoji="üìö">üìö</div>
                        <div class="emoji-option" data-emoji="üèÉ">üèÉ</div>
                        <div class="emoji-option" data-emoji="üßò">üßò</div>
                        <div class="emoji-option" data-emoji="üíª">üíª</div>
                        <div class="emoji-option" data-emoji="üé®">üé®</div>
                        <div class="emoji-option" data-emoji="üéµ">üéµ</div>
                        <div class="emoji-option" data-emoji="‚úçÔ∏è">‚úçÔ∏è</div>
                        <div class="emoji-option" data-emoji="ü•ó">ü•ó</div>
                        <div class="emoji-option" data-emoji="üíß">üíß</div>
                        <div class="emoji-option" data-emoji="üõå">üõå</div>
                        <div class="emoji-option" data-emoji="üö´">üö´</div>
                        <div class="emoji-option" data-emoji="üì±">üì±</div>
                        <div class="emoji-option" data-emoji="üßº">üßº</div>
                        <div class="emoji-option" data-emoji="üéØ">üéØ</div>
                        <div class="emoji-option" data-emoji="‚è∞">‚è∞</div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Habit</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const state = {
            currentMonth: new Date().getMonth(),
            currentYear: new Date().getFullYear(),
            habits: [
                { id: 1, name: 'Wake up at 05:00', icon: '‚è∞', completed: {}, goal: 30 },
                { id: 2, name: 'Gym', icon: 'üí™', completed: {}, goal: 25, trackingType: 'time', trackingData: {} },
                { id: 3, name: 'Reading / Learning', icon: 'üìö', completed: {}, goal: 30, trackingType: 'time', trackingData: {} },
                { id: 4, name: 'Day Planning', icon: 'üìù', completed: {}, goal: 30, trackingType: 'checkbox' },
                { id: 5, name: 'Budget Tracking', icon: 'üí∞', completed: {}, goal: 30, trackingType: 'amount', trackingData: {} },
                { id: 6, name: 'Project Work', icon: 'üíª', completed: {}, goal: 25, trackingType: 'time', trackingData: {} },
                { id: 7, name: 'No Alcohol', icon: 'üö´', completed: {}, goal: 30, trackingType: 'checkbox' },
                { id: 8, name: 'Social Media Detox', icon: 'üì±', completed: {}, goal: 30, trackingType: 'time', trackingData: {} },
                { id: 9, name: 'Goal Journaling', icon: '‚úçÔ∏è', completed: {}, goal: 30, trackingType: 'checkbox' },
                { id: 10, name: 'Cold Shower', icon: 'üöø', completed: {}, goal: 20, trackingType: 'checkbox' }
            ],
            notes: {},
            selectedEmoji: '',
            editingHabitId: null,
            contextMenuTarget: null,
            nextId: 11,
            selectedTrackingType: 'checkbox',
            badges: [
                { id: 'first_day', name: 'First Step', icon: 'üéØ', description: 'Complete first habit', earned: false },
                { id: 'week_streak', name: '7 Day Streak', icon: 'üî•', description: 'Complete 7 days in a row', earned: false },
                { id: 'perfect_week', name: 'Perfect Week', icon: '‚≠ê', description: 'Complete all habits for 7 days', earned: false },
                { id: 'habit_master', name: 'Habit Master', icon: 'üëë', description: 'Complete 100 total habits', earned: false },
                { id: 'consistency', name: 'Consistency', icon: 'üíé', description: 'Complete same habit 30 times', earned: false },
                { id: 'early_bird', name: 'Early Bird', icon: 'üåÖ', description: 'Wake up at 05:00 for 30 days', earned: false }
            ]
        };

        function getDaysInMonth(month, year) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getMonthName(month, year) {
            return new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });
        }

        function getDayOfWeek(day, month, year) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const date = new Date(year, month, day);
            return days[date.getDay()];
        }

        function renderMonth() {
            document.getElementById('monthDisplay').textContent = getMonthName(state.currentMonth, state.currentYear);
            renderTable();
            updateStats();
            renderAnalytics();
        }

        function renderTable() {
            const daysInMonth = getDaysInMonth(state.currentMonth, state.currentYear);
            const headerRow = document.getElementById('tableHeader');
            
            headerRow.innerHTML = '<th class="habit-name-cell">Habit</th>';
            for (let day = 1; day <= daysInMonth; day++) {
                const th = document.createElement('th');
                const dayOfWeek = getDayOfWeek(day, state.currentMonth, state.currentYear);
                th.innerHTML = `${day}<br><span class="day-of-week">${dayOfWeek}</span>`;
                headerRow.appendChild(th);
            }

            const tbody = document.getElementById('habitTableBody');
            tbody.innerHTML = '';

            state.habits.forEach(habit => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.className = 'habit-name-cell';
                nameCell.innerHTML = `
                    <div class="habit-name-display">
                        <span class="habit-name-text">${habit.icon} ${habit.name}</span>
                        <button class="edit-habit-btn" data-habit-id="${habit.id}">‚úèÔ∏è</button>
                    </div>
                `;
                row.appendChild(nameCell);

                for (let day = 1; day <= daysInMonth; day++) {
                    const cell = document.createElement('td');
                    cell.className = 'checkbox-cell';
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    
                    if (habit.completed[dateKey]) {
                        cell.classList.add('checked');
                        cell.innerHTML = '<span class="checkmark">‚úì</span>';
                    }

                    const noteKey = `${habit.id}-${dateKey}`;
                    if (state.notes[noteKey]) {
                        cell.classList.add('has-note');
                    }

                    cell.addEventListener('click', (e) => {
                        if (e.ctrlKey || e.metaKey) {
                            openTrackingModal(habit.id, dateKey, day);
                        } else {
                            toggleHabit(habit.id, dateKey);
                        }
                    });

                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        showContextMenu(e, habit.id, dateKey, day);
                    });

                    let touchTimer;
                    cell.addEventListener('touchstart', (e) => {
                        touchTimer = setTimeout(() => {
                            e.preventDefault();
                            showContextMenu(e.touches[0], habit.id, dateKey, day);
                        }, 500);
                    });

                    cell.addEventListener('touchend', () => {
                        clearTimeout(touchTimer);
                    });

                    row.appendChild(cell);
                }

                tbody.appendChild(row);
            });

            document.querySelectorAll('.edit-habit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const habitId = parseInt(btn.dataset.habitId);
                    openEditModal(habitId);
                });
            });
        }

        function toggleHabit(habitId, dateKey) {
            const habit = state.habits.find(h => h.id === habitId);
            if (habit.completed[dateKey]) {
                delete habit.completed[dateKey];
            } else {
                habit.completed[dateKey] = true;
            }
            renderMonth();
        }

        function calculateStreak() {
            const today = new Date();
            let streak = 0;
            let checkDate = new Date(today);

            while (true) {
                const dateKey = `${checkDate.getFullYear()}-${checkDate.getMonth()}-${checkDate.getDate()}`;
                const completedCount = state.habits.filter(h => h.completed[dateKey]).length;
                
                if (completedCount === 0) break;
                
                streak++;
                checkDate.setDate(checkDate.getDate() - 1);
            }

            return streak;
        }

        function updateStats() {
            const daysInMonth = getDaysInMonth(state.currentMonth, state.currentYear);
            const totalPossible = state.habits.length * daysInMonth;
            let totalCompleted = 0;

            state.habits.forEach(habit => {
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    if (habit.completed[dateKey] || (habit.trackingData && habit.trackingData[dateKey])) {
                        totalCompleted++;
                    }
                }
            });

            const completionRate = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            const streak = calculateStreak();

            document.getElementById('totalHabits').textContent = state.habits.length;
            document.getElementById('completedTasks').textContent = totalCompleted;
            document.getElementById('completionRate').textContent = `${completionRate}% completion rate`;
            document.getElementById('currentStreak').textContent = streak;
            document.getElementById('streakNumber').textContent = streak;
            document.getElementById('monthlyProgress').textContent = `${completionRate}%`;
            document.getElementById('progressBarFill').style.width = `${completionRate}%`;

            let bestHabit = null;
            let bestScore = 0;

            state.habits.forEach(habit => {
                let completed = 0;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    if (habit.completed[dateKey] || (habit.trackingData && habit.trackingData[dateKey])) completed++;
                }
                const score = Math.round((completed / daysInMonth) * 100);
                if (score > bestScore) {
                    bestScore = score;
                    bestHabit = habit;
                }
            });

            if (bestHabit) {
                document.getElementById('bestHabitScore').textContent = `${bestScore}%`;
                document.getElementById('bestHabitName').textContent = bestHabit.name;
            }
        }

        function renderAnalytics() {
            const performanceList = document.getElementById('habitPerformanceList');
            performanceList.innerHTML = '';

            const daysInMonth = getDaysInMonth(state.currentMonth, state.currentYear);

            const habitScores = state.habits.map(habit => {
                let completed = 0;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    if (habit.completed[dateKey] || (habit.trackingData && habit.trackingData[dateKey])) completed++;
                }
                return {
                    habit,
                    completed,
                    percentage: Math.round((completed / daysInMonth) * 100)
                };
            }).sort((a, b) => b.percentage - a.percentage);

            habitScores.forEach(({ habit, completed, percentage }) => {
                const item = document.createElement('div');
                item.className = 'habit-item';
                item.innerHTML = `
                    <span class="habit-item-name">${habit.icon} ${habit.name}</span>
                    <span class="habit-item-score">${percentage}%</span>
                `;
                performanceList.appendChild(item);
            });

            renderGoalVsActual();
            renderBadges();
            renderWeeklyChart();
        }

        function renderGoalVsActual() {
            const goalVsActual = document.getElementById('goalVsActual');
            goalVsActual.innerHTML = '';

            const daysInMonth = getDaysInMonth(state.currentMonth, state.currentYear);

            state.habits.forEach(habit => {
                let actual = 0;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    if (habit.completed[dateKey] || (habit.trackingData && habit.trackingData[dateKey])) actual++;
                }

                const goal = habit.goal || daysInMonth;
                const percentage = Math.min(Math.round((actual / goal) * 100), 100);

                const item = document.createElement('div');
                item.className = 'goal-item';
                item.innerHTML = `
                    <div class="goal-label">${habit.icon}</div>
                    <div class="goal-bar">
                        <div class="goal-bar-fill" style="width: ${percentage}%">${actual}</div>
                    </div>
                    <div class="goal-numbers">${actual}/${goal}</div>
                `;
                goalVsActual.appendChild(item);
            });
        }

        function renderBadges() {
            checkBadges();
            const badgeContainer = document.getElementById('badgeContainer');
            badgeContainer.innerHTML = '';

            state.badges.forEach(badge => {
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${badge.earned ? 'earned' : ''}`;
                badgeEl.innerHTML = `
                    <div class="badge-icon">${badge.icon}</div>
                    <div class="badge-name">${badge.name}</div>
                `;
                badgeEl.title = badge.description;
                badgeContainer.appendChild(badgeEl);
            });
        }

        function checkBadges() {
            const daysInMonth = getDaysInMonth(state.currentMonth, state.currentYear);
            let totalCompleted = 0;

            state.habits.forEach(habit => {
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    if (habit.completed[dateKey] || (habit.trackingData && habit.trackingData[dateKey])) totalCompleted++;
                }
            });

            if (totalCompleted > 0) {
                const badge = state.badges.find(b => b.id === 'first_day');
                if (badge) badge.earned = true;
            }

            if (totalCompleted >= 100) {
                const badge = state.badges.find(b => b.id === 'habit_master');
                if (badge) badge.earned = true;
            }

            const streak = calculateStreak();
            if (streak >= 7) {
                const badge = state.badges.find(b => b.id === 'week_streak');
                if (badge) badge.earned = true;
            }

            const wakeUpHabit = state.habits.find(h => h.name.includes('05:00'));
            if (wakeUpHabit) {
                let wakeUpCount = 0;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                    if (wakeUpHabit.completed[dateKey] || (wakeUpHabit.trackingData && wakeUpHabit.trackingData[dateKey])) wakeUpCount++;
                }
                if (wakeUpCount >= 30) {
                    const badge = state.badges.find(b => b.id === 'early_bird');
                    if (badge) badge.earned = true;
                }
            }
        }

        function renderWeeklyChart() {
            const weeklyChart = document.getElementById('weeklyChart');
            weeklyChart.innerHTML = '';

            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const weeklyData = [0, 0, 0, 0, 0, 0, 0];

            const daysInMonth = getDaysInMonth(state.currentMonth, state.currentYear);

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(state.currentYear, state.currentMonth, day);
                const dayOfWeek = date.getDay();
                const dateKey = `${state.currentYear}-${state.currentMonth}-${day}`;
                
                const completedCount = state.habits.filter(h => h.completed[dateKey] || (h.trackingData && h.trackingData[dateKey])).length;
                weeklyData[dayOfWeek] += completedCount;
            }

            const maxValue = Math.max(...weeklyData, 1);
            let bestDayIndex = 0;
            let bestDayValue = weeklyData[0];

            weeklyData.forEach((value, index) => {
                if (value > bestDayValue) {
                    bestDayValue = value;
                    bestDayIndex = index;
                }

                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                const heightPercentage = (value / maxValue) * 100;
                bar.style.height = `${heightPercentage}%`;
                bar.innerHTML = `<span class="chart-bar-label">${daysOfWeek[index]}</span>`;
                weeklyChart.appendChild(bar);
            });

            document.getElementById('bestDayDisplay').innerHTML = 
                `<span class="best-day-badge">Best Day: ${daysOfWeek[bestDayIndex]}</span>`;
        }

        document.getElementById('prevMonth').addEventListener('click', () => {
            state.currentMonth--;
            if (state.currentMonth < 0) {
                state.currentMonth = 11;
                state.currentYear--;
            }
            renderMonth();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            state.currentMonth++;
            if (state.currentMonth > 11) {
                state.currentMonth = 0;
                state.currentYear++;
            }
            renderMonth();
        });

        const modal = document.getElementById('addHabitModal');
        const addHabitBtn = document.getElementById('addHabitBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const addHabitForm = document.getElementById('addHabitForm');
        const emojiSelector = document.getElementById('emojiSelector');

        addHabitBtn.addEventListener('click', () => {
            modal.classList.add('active');
        });

        cancelBtn.addEventListener('click', () => {
            modal.classList.remove('active');
            addHabitForm.reset();
            state.selectedEmoji = '';
            document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                addHabitForm.reset();
                state.selectedEmoji = '';
                document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
            }
        });

        emojiSelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('emoji-option')) {
                document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
                e.target.classList.add('selected');
                state.selectedEmoji = e.target.dataset.emoji;
            }
        });

        addHabitForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const habitName = document.getElementById('habitName').value.trim();
            const icon = state.selectedEmoji || 'üéØ';
            const trackingType = document.getElementById('trackingTypeSelect').value;

            state.habits.push({
                id: state.nextId++,
                name: habitName,
                icon: icon,
                completed: {},
                goal: 30,
                trackingType: trackingType,
                trackingData: {}
            });

            modal.classList.remove('active');
            addHabitForm.reset();
            state.selectedEmoji = '';
            document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
            renderMonth();
        });

        const editHabitModal = document.getElementById('editHabitModal');
        const editHabitForm = document.getElementById('editHabitForm');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const deleteHabitBtn = document.getElementById('deleteHabitBtn');
        const editEmojiSelector = document.getElementById('editEmojiSelector');

        function openEditModal(habitId) {
            const habit = state.habits.find(h => h.id === habitId);
            if (!habit) return;

            state.editingHabitId = habitId;
            document.getElementById('editHabitName').value = habit.name;
            state.selectedEmoji = habit.icon;

            document.querySelectorAll('#editEmojiSelector .emoji-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.emoji === habit.icon) {
                    opt.classList.add('selected');
                }
            });

            editHabitModal.classList.add('active');
        }

        cancelEditBtn.addEventListener('click', () => {
            editHabitModal.classList.remove('active');
            state.editingHabitId = null;
        });

        editHabitModal.addEventListener('click', (e) => {
            if (e.target === editHabitModal) {
                editHabitModal.classList.remove('active');
                state.editingHabitId = null;
            }
        });

        editEmojiSelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('emoji-option')) {
                document.querySelectorAll('#editEmojiSelector .emoji-option').forEach(opt => opt.classList.remove('selected'));
                e.target.classList.add('selected');
                state.selectedEmoji = e.target.dataset.emoji;
            }
        });

        editHabitForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const habit = state.habits.find(h => h.id === state.editingHabitId);
            if (habit) {
                habit.name = document.getElementById('editHabitName').value.trim();
                habit.icon = state.selectedEmoji;
            }
            editHabitModal.classList.remove('active');
            state.editingHabitId = null;
            renderMonth();
        });

        deleteHabitBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to delete this habit? This action cannot be undone.')) {
                state.habits = state.habits.filter(h => h.id !== state.editingHabitId);
                editHabitModal.classList.remove('active');
                state.editingHabitId = null;
                renderMonth();
            }
        });

        const contextMenu = document.getElementById('contextMenu');
        const noteModal = document.getElementById('noteModal');
        const cancelNoteBtn = document.getElementById('cancelNoteBtn');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const addNoteOption = document.getElementById('addNoteOption');
        const viewNoteOption = document.getElementById('viewNoteOption');

        function showContextMenu(e, habitId, dateKey, day) {
            state.contextMenuTarget = { habitId, dateKey, day };
            contextMenu.style.left = `${e.pageX}px`;
            contextMenu.style.top = `${e.pageY}px`;
            contextMenu.classList.add('active');

            const noteKey = `${habitId}-${dateKey}`;
            if (state.notes[noteKey]) {
                viewNoteOption.style.display = 'block';
            } else {
                viewNoteOption.style.display = 'none';
            }
        }

        document.addEventListener('click', () => {
            contextMenu.classList.remove('active');
        });

        addNoteOption.addEventListener('click', () => {
            openNoteModal();
        });

        viewNoteOption.addEventListener('click', () => {
            openNoteModal(true);
        });

        function openNoteModal(viewMode = false) {
            if (!state.contextMenuTarget) return;

            const { habitId, dateKey, day } = state.contextMenuTarget;
            const habit = state.habits.find(h => h.id === habitId);
            const noteKey = `${habitId}-${dateKey}`;

            document.getElementById('noteInfo').textContent = 
                `${habit.icon} ${habit.name} - Day ${day}, ${getMonthName(state.currentMonth, state.currentYear)}`;

            if (viewMode && state.notes[noteKey]) {
                document.getElementById('noteText').value = state.notes[noteKey];
            } else {
                document.getElementById('noteText').value = state.notes[noteKey] || '';
            }

            noteModal.classList.add('active');
        }

        cancelNoteBtn.addEventListener('click', () => {
            noteModal.classList.remove('active');
            document.getElementById('noteText').value = '';
        });

        noteModal.addEventListener('click', (e) => {
            if (e.target === noteModal) {
                noteModal.classList.remove('active');
                document.getElementById('noteText').value = '';
            }
        });

        saveNoteBtn.addEventListener('click', () => {
            if (!state.contextMenuTarget) return;

            const { habitId, dateKey } = state.contextMenuTarget;
            const noteKey = `${habitId}-${dateKey}`;
            const noteText = document.getElementById('noteText').value.trim();

            if (noteText) {
                state.notes[noteKey] = noteText;
            } else {
                delete state.notes[noteKey];
            }

            noteModal.classList.remove('active');
            document.getElementById('noteText').value = '';
            renderTable();
        });

        const exportBtn = document.getElementById('exportBtn');
        exportBtn.addEventListener('click', () => {
            const data = {
                habits: state.habits,
                notes: state.notes,
                badges: state.badges,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `habit-tracker-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

        const trackingModal = document.getElementById('trackingModal');
        const cancelTrackingBtn = document.getElementById('cancelTrackingBtn');
        const saveTrackingBtn = document.getElementById('saveTrackingBtn');

        function openTrackingModal(habitId, dateKey, day) {
            const habit = state.habits.find(h => h.id === habitId);
            if (!habit || habit.trackingType === 'checkbox') return;

            state.contextMenuTarget = { habitId, dateKey, day };

            document.getElementById('trackingInfo').textContent = 
                `${habit.icon} ${habit.name} - Day ${day}, ${getMonthName(state.currentMonth, state.currentYear)}`;

            const formContent = document.getElementById('trackingFormContent');
            const existingValue = habit.trackingData[dateKey] || '';

            if (habit.trackingType === 'time') {
                formContent.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Time Spent (minutes)</label>
                        <input type="number" id="trackingValue" class="form-input" placeholder="e.g., 60" min="0" value="${existingValue}">
                    </div>
                `;
            } else if (habit.trackingType === 'amount') {
                formContent.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Amount Spent (‚Çπ)</label>
                        <input type="number" id="trackingValue" class="form-input" placeholder="e.g., 500" min="0" step="0.01" value="${existingValue}">
                    </div>
                `;
            }

            trackingModal.classList.add('active');
        }

        cancelTrackingBtn.addEventListener('click', () => {
            trackingModal.classList.remove('active');
        });

        trackingModal.addEventListener('click', (e) => {
            if (e.target === trackingModal) {
                trackingModal.classList.remove('active');
            }
        });

        saveTrackingBtn.addEventListener('click', () => {
            if (!state.contextMenuTarget) return;

            const { habitId, dateKey } = state.contextMenuTarget;
            const habit = state.habits.find(h => h.id === habitId);
            const value = document.getElementById('trackingValue').value.trim();

            if (value && parseFloat(value) > 0) {
                if (!habit.trackingData) habit.trackingData = {};
                habit.trackingData[dateKey] = parseFloat(value);
                habit.completed[dateKey] = true;
            } else {
                if (habit.trackingData) delete habit.trackingData[dateKey];
                delete habit.completed[dateKey];
            }

            trackingModal.classList.remove('active');
            renderMonth();
        });

        addNoteOption.textContent = 'üìù Add/Edit Note';

        renderMonth();
    </script>
</body>
</html>

